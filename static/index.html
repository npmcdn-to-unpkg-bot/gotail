<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{.Title}}</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="https://npmcdn.com/redux@latest/dist/redux.min.js"></script>
</head>
<body>

<div id="content"></div>
<script type="text/babel">

    var loc = window.location;

    function counter(state, action) {
        if (typeof state === 'undefined') {
          return {lines: []}
        }
        switch (action.type) {
          case 'APPEND':
          console.log(state)
          state.lines.push(action.lines)
            return state
          default:
            return state
        }
      }
      var store = Redux.createStore(counter)
      var content = document.getElementById('content')

      function render() {
        ReactDOM.render(
            <Counter props={store.getState()} />,
            content
          )
      }

      render()
      store.subscribe(render)

    var socket = new WebSocket("{{.WSProtocol}}://" + loc.host + "/socket");
    socket.onmessage = function(msg) {
        store.dispatch({ type: 'APPEND', lines: msg.data })
    }
    </script>
</body>
</html>

